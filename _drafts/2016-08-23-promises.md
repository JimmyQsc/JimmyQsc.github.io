---
title: JavaScript Promises
subtitle: Make Asynchronous Easier
date: 2016-08-13
categories: 笔记
author: Jimmy Q
permalink: js-promises
---
最近接触到一个比较新的技术：service worker， 这项技术，可以让网站开发采用离线优先的策略。一般我们不会想在离线的情况下去访问一个网站，
因为我们看网页是为了网页上的内容，而且我们总是想要最新的内容。但现在的网站开发技术越来越强大，一张网页就是一个应用。没有网络连接就无法
访问网络（废话），但注重用户体验的网站开发者不想在用户离线时只留给用户一片的空白，因此有了service worker这项技术。

Service worker可以让网站开发采用离线优先的策略，这样的方式有两种好处：
1. 在用户离线时，显示缓存的内容，而不是一片空白；
2. 即使用户有网络连接，也只在内容更新后才请求新数据，在没有更新的情况下，用户也就没有等待时间。

这对用户体验的提升是十分明显的，这也是web app产生用户黏度的关键之一。

于是，进入到这篇文章的主题，service worker的实现十分广泛的使用了promise，要使用它，理解promise是一个前提条件。

promise是在ES6的新特性，也是在开发者中呼声很高的倍受欢迎的特性，(At first I don't know what's all the fuss about)
他让处理异步请求更加灵活，语法更加自然，处理错误更方便(cheers!)。

## AJAX 和 XMLHttpRequest

先来看一下我们是如何使用ajax的：

```javascript
// jQuery
$.getJSON(urlString, function(data) {
    //do something with the data
}).fail(function() {
    //error handle
});


// vanilla JavaScript 
var request = new XMLHttpRequest();
request.open('GET', urlString, true);

request.onload = function() {  //register a onload event listener
    if (request.status >= 200 && request.status < 400) {
        // request successed
        var data = JSON.parse(request.responseText);
        //do something with the data
    } else {
        // error
    }
};

request.onerror = function() {
    //error handle
};

request.send();
```
 

